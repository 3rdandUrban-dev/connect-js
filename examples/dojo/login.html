<!doctype html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <title>Mu Dojo Login Example</title>
  </head>
  <body>
    <h1>Mu Dojo Login Example</h1>
    <div>
      <button id="login">Login</button>
      <button id="logout">Logout</button>
      <button id="disconnect">Disconnect</button>
    </div>
    <div id="user-info"></div>

    <script src="http://ajax.googleapis.com/ajax/libs/dojo/1.3.2/dojo/dojo.xd.js"></script>

    <div id="mu-root"></div>
    <script src="http://mu.daaku.org/m.js"></script>
    <script>
      // initialize the library with the API key
      Mu.init({ apiKey: '48f06bc570aaf9ed454699ec4fe416df' });

      // fetch the status on load
      Mu.status(handleSessionResponse);

      dojo.connect(dojo.byId('login'), 'click', function() {
        Mu.login(handleSessionResponse);
      });

      dojo.connect(dojo.byId('logout'), 'click', function() {
        Mu.logout(handleSessionResponse);
      });

      dojo.connect(dojo.byId('disconnect'), 'click', function() {
        Mu.api({ method: 'Auth.revokeAuthorization' }, function(response) {
          clearDisplay();
        });
      });

      // no user, clear display
      function clearDisplay() {
        document.getElementById('user-info').innerHTML = '';
      }

      // handle a session response from any of the auth related calls
      function handleSessionResponse(response) {
        // if we dont have a session, just hide the user info
        if (!response.session) {
          clearDisplay();
          return;
        }

        // if we have a session, query for the user's profile picture and name
        Mu.api(
          {
            method: 'fql.query',
            query: 'SELECT name, pic FROM profile WHERE id=' + Mu.session().uid
          },
          function(response) {
            var user = response[0];
            var userInfo = document.getElementById('user-info');
            userInfo.innerHTML = '<img src="' + user.pic + '">' + user.name;
          }
        );
      }
    </script>



    <script src="http://www.google-analytics.com/ga.js"></script>
    <script>
      try {
        var pageTracker = _gat._getTracker('UA-7621205-4');
        pageTracker._trackPageview();
      } catch(e) {}
    </script>
  </body>
</html>
